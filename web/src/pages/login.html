

<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light" />
    <title>SENTRY MESSENGER ‚Äî Login</title>
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/assets/styles.css" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <style>
      :root { color-scheme: light; --bg:#0f172a; --fg:#111827; --muted:#64748b; --line:#e2e8f0; --card:#ffffff; --gradient: linear-gradient(160deg,#0f172a,#1e293b 65%,#020617); }
      html, body { height:100%; min-height:100%; }
      html { background:var(--gradient); }
      html, body { height:100%; min-height:100%; }
      html { background:var(--gradient); }
      * { box-sizing:border-box; }
      body {
        margin:0;
        min-height:100vh;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, 'Noto Sans TC', sans-serif;
        background:var(--gradient);
        display:flex;
        justify-content:center;
        align-items:center;
        padding:32px 18px;
      }
      .login-shell {
        width:min(420px,100%);
        background:var(--card);
        border-radius:24px;
        padding:32px 26px 36px;
        box-shadow:0 26px 60px rgba(15,23,42,0.45);
      }
      .brand { display:flex; align-items:center; gap:12px; margin-bottom:18px; }
      .brand img { height:30px; width:auto; }
      .brand h1 { margin:0; font-size:22px; font-weight:700; letter-spacing:0.4px; color:var(--fg); }
      .subtitle { margin:0 0 24px; color:var(--muted); font-size:13px; line-height:1.5; }
      form { display:flex; flex-direction:column; gap:16px; }
      .form-group { display:flex; flex-direction:column; gap:6px; }
      .form-group.hidden { display:none; }
      .hidden { display:none !important; }
      .form-group label { font-size:13px; color:var(--muted); }
      .input {
        width:100%;
        border:1px solid var(--line);
        border-radius:14px;
        padding:12px 14px;
        font-size:15px;
        background:#f8fafc;
        transition:border-color .2s, box-shadow .2s;
      }
      .input.display {
        background:#eef2ff;
        border-style:dashed;
        color:#1e293b;
        min-height:48px;
        display:flex;
        align-items:center;
      }
      .input:focus {
        outline:none;
        border-color:#6366f1;
        box-shadow:0 0 0 3px rgba(99,102,241,0.18);
        background:#fff;
      }
      .grid-two { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; }
      button {
        border:none;
        border-radius:16px;
        padding:12px 16px;
        font-size:15px;
        font-weight:600;
        cursor:pointer;
        transition:transform .15s ease, box-shadow .15s ease;
      }
      button.primary {
        background:linear-gradient(135deg,#0f172a,#1e293b);
        color:#fff;
        box-shadow:0 14px 32px rgba(15,23,42,0.35);
      }
      button.secondary { background:#f1f5f9; color:#0f172a; }
      button:disabled { opacity:0.55; cursor:not-allowed; box-shadow:none; }
      button:active { transform:translateY(1px); }
      .actions { display:flex; flex-direction:column; gap:10px; margin-top:4px; }
      .password-field { position:relative; display:flex; align-items:center; }
      .password-field .input { padding-right:42px; }
      .password-toggle {
        position:absolute;
        right:10px;
        top:50%;
        transform:translateY(-50%);
        border:none;
        background:transparent;
        color:#475569;
        font-size:18px;
        cursor:pointer;
        padding:4px;
      }
      .password-toggle i { font-size:20px; }
      .password-toggle:focus { outline:none; }
      .notice {
        display:flex;
        align-items:flex-start;
        gap:10px;
        font-size:12px;
        color:#0f172a;
        line-height:1.6;
        background:rgba(56,189,248,0.12);
        border:1px solid rgba(56,189,248,0.6);
        border-radius:16px;
        padding:12px 14px;
      }
      .notice-icon {
        display:inline-flex;
        align-items:center;
        justify-content:center;
        background:rgba(56,189,248,0.2);
        color:#0284c7;
        border-radius:999px;
        width:28px;
        height:28px;
        font-size:15px;
        flex-shrink:0;
      }
      .notice-text {
        margin:0;
        color:#0f172a;
      }
      .modal { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:50; }
      .modal-backdrop { position:absolute; inset:0; background:rgba(15,23,42,0.55); backdrop-filter:blur(4px); }
      .modal-panel { position:relative; z-index:1; width:min(360px,90vw); background:#0f172a; color:#f8fafc; border-radius:20px; padding:22px 20px; box-shadow:0 24px 60px rgba(2,6,23,0.55); display:flex; flex-direction:column; gap:12px; }
      .modal-head { display:flex; justify-content:space-between; align-items:center; font-weight:600; font-size:15px; }
      .modal-body { font-size:13px; line-height:1.6; white-space:pre-wrap; word-break:break-word; }
      .modal-close { border:none; background:rgba(248,250,252,0.12); color:#f8fafc; border-radius:999px; width:30px; height:30px; cursor:pointer; }
      .modal-close:active { transform:translateY(1px); }
      .welcome-modal .modal-panel { background:#0b1220; }
      .welcome-modal h2 { margin:0 0 8px; font-size:18px; letter-spacing:0.4px; }
      .welcome-modal ul { margin:0; padding-left:18px; display:flex; flex-direction:column; gap:8px; font-size:13px; line-height:1.6; }
      .welcome-actions { display:flex; justify-content:flex-end; }
      .welcome-actions button { border-radius:12px; padding:8px 16px; background:#38bdf8; color:#0f172a; font-weight:600; border:none; cursor:pointer; }
      .welcome-actions button:active { transform:translateY(1px); }
      .dev-hidden { display:none !important; }
      .loading-backdrop { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(15,23,42,0.85); backdrop-filter:blur(3px); z-index:100; }
      .loading-card { display:flex; flex-direction:column; align-items:center; gap:14px; padding:26px 30px; border-radius:20px; background:#0b1220; color:#f8fafc; box-shadow:0 22px 48px rgba(2,6,23,0.45); min-width:220px; }
      .loading-spinner { width:48px; height:48px; border-radius:50%; border:4px solid rgba(148,163,184,0.25); border-top-color:#38bdf8; animation:login-spin .9s linear infinite; }
      .loading-text { font-size:14px; line-height:1.6; text-align:center; letter-spacing:0.5px; }
      @keyframes login-spin { to { transform:rotate(360deg); } }
      .orientation-overlay { position:fixed; inset:0; background:linear-gradient(160deg,rgba(15,23,42,0.98),rgba(15,23,42,0.92)); color:#f8fafc; display:none; align-items:center; justify-content:center; flex-direction:column; gap:12px; text-align:center; padding:32px; z-index:2000; font-size:18px; line-height:1.6; letter-spacing:0.4px; }
      .orientation-overlay .icon { font-size:42px; display:block; }
      html.orientation-block { height:100%; overflow:hidden; }
      html.orientation-block body { overflow:hidden; height:100%; }
      html.orientation-block .orientation-overlay { display:flex; }
    </style>
  </head>
  <body>
    <div id="orientationOverlay" class="orientation-overlay" aria-hidden="true">
      <span class="icon" aria-hidden="true">üì±</span>
      <strong>Ë´ã‰ª•Áõ¥Á´ãÊ®°Âºè‰ΩøÁî®</strong>
      <span>ÁÇ∫Á∂≠ÊåÅÊúÄ‰Ω≥‰ΩøÁî®È´îÈ©óÔºåË´ãÂ∞áË£ùÁΩÆÊóãËΩâÂõûÁõ¥Á´ãÊñπÂêë„ÄÇ</span>
    </div>
    <main class="login-shell">
      <div class="brand">
        <img src="/assets/images/logo.svg" alt="SENTRY MESSENGER" />
        <h1>SENTRY MESSENGER</h1>
      </div>
      <p class="subtitle">ÊÑüÊáâ SENTRY MESSENGER Êô∂ÁâáÂæåËº∏ÂÖ•ÂØÜÁ¢ºÂç≥ÂèØÁôªÂÖ•„ÄÇ</p>

      <form autocomplete="off" data-1p-ignore="true" data-lpignore="true">
        <div class="form-group">
          <label for="uidHexDisplay">Êô∂ÁâáÂ∫èËôü</label>
          <div id="uidHexDisplay" class="input display">Â∞öÊú™ÂÅµÊ∏¨</div>
          <input id="uidHex" type="hidden" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
        </div>

        <div class="grid-two">
          <div class="form-group hidden" id="macWrapper">
            <label for="sdmMac">NTAG MACÔºà16 hexÔºâ</label>
            <input id="sdmMac" class="input" type="text" placeholder="501EC4EF6E38555E" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
          </div>
          <div class="form-group hidden" id="ctrWrapper">
            <label for="sdmCtr">Counter</label>
            <input id="sdmCtr" class="input" type="text" placeholder="50 Êàñ 000050" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
          </div>
        </div>

        <div class="form-group hidden" id="nonceWrapper">
          <label for="nonce">NonceÔºàÈÅ∏Â°´Ôºâ</label>
          <input id="nonce" class="input" type="text" placeholder="optional" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" />
        </div>

        <button id="btnSdmExchange" type="button" class="primary hidden" style="width:100%">È©óË≠â NTAGÔºàSDM ExchangeÔºâ</button>

        <div class="form-group hidden" id="sessionWrapper">
          <label for="sessionView">‰∏ÄÊ¨°ÊÄß Session</label>
          <input id="sessionView" class="input" type="text" readonly placeholder="È©óË≠âÂæåËá™ÂãïÂ∏∂ÂÖ•" />
        </div>

        <div class="form-group" id="passwordWrapper">
          <label for="pwd">ÁôªÂÖ•ÂØÜÁ¢º</label>
          <div class="password-field">
            <input id="pwd" class="input" type="password" placeholder="Ëá≥Â∞ëÂÖ≠‰ΩçÊï∏" autocomplete="new-password" autocapitalize="off" autocorrect="off" spellcheck="false" data-1p-ignore="true" data-lpignore="true" name="__no_store_pwd__" />
            <button type="button" class="password-toggle" data-target="pwd" aria-label="È°ØÁ§∫ÂØÜÁ¢º"><i class='bx bx-show'></i></button>
          </div>
        </div>

        <div class="form-group hidden" id="confirmWrapper">
          <label for="pwdConfirm">Á¢∫Ë™çÂØÜÁ¢º</label>
          <div class="password-field">
            <input id="pwdConfirm" class="input" type="password" placeholder="ÂÜçÊ¨°Ëº∏ÂÖ•ÂØÜÁ¢º" autocomplete="new-password" autocapitalize="off" autocorrect="off" spellcheck="false" />
            <button type="button" class="password-toggle" data-target="pwdConfirm" aria-label="È°ØÁ§∫ÂØÜÁ¢º"><i class='bx bx-show'></i></button>
          </div>
        </div>

      <div class="actions">
        <button id="btnUnlock" type="button" class="primary" disabled>ÁôªÂÖ•</button>
        <button id="btnSimDebug" type="button" class="secondary hidden">DEBUG Ê®°Êì¨ÁôªÂÖ•</button>
      </div>

      <p class="notice"><span class="notice-icon" aria-hidden="true">üîí</span><span class="notice-text">SENTRY MESSENGER Êé°Áî® E2EE Á´ØÂ∞çÁ´ØÂä†ÂØÜÊäÄË°ìÔºåÊâÄÊúâÂä†Ëß£ÂØÜÂùáÊñºÂâçÁ´ØË®àÁÆóÔºå‰º∫ÊúçÂô®Á´ØÂÉÖÂÑ≤Â≠òÂä†ÂØÜÈÅéÁöÑË≥áË®äÔºåÊâÄÊúâÊïèÊÑüË≥áË®äÂÉÖ‰øùÁïôÊñºË®òÊÜ∂È´îÔºå‰∏¶ÊñºÁï´Èù¢ÂàáÊèõÊôÇÂç≥ÂàªÊ∏ÖÈô§„ÄÇ</span></p>
    </form>
    <div id="loginModal" class="modal hidden" aria-hidden="true">
      <div class="modal-backdrop" id="loginModalBackdrop"></div>
      <div class="modal-panel" role="dialog" aria-modal="true">
        <div class="modal-head">
          <span>Á≥ªÁµ±Ë®äÊÅØ</span>
          <button id="loginModalClose" class="modal-close" type="button">√ó</button>
        </div>
        <div id="loginModalBody" class="modal-body"></div>
      </div>
    </div>
    <div id="welcomeModal" class="modal welcome-modal hidden" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-panel" role="dialog" aria-modal="true">
        <div class="modal-head">
          <h2>ËøéÊé•Â∂ÑÊñ∞ÁöÑÈö±ÁßÅÈÄöË®äÔºÅ</h2>
          <button type="button" class="modal-close" id="welcomeClose">√ó</button>
        </div>
        <div id="welcomeContent" class="modal-body" tabindex="-1">
          <ul>
            <li>Èõ∂Ê≠ªËßíÊé°Áî®ÊúÄÂÖàÈÄ≤ÁöÑ E2EE Á´ØÂ∞çÁ´ØÂä†ÂØÜÊäÄË°ì„ÄÇ</li>
            <li>ÊàëÂÄëÁÑ°Ê≥ïÂæóÁü•‰Ω†Ë∑üË™∞ËÅäÂ§©„ÄÅËÅä‰∫Ü‰ªÄÈ∫º„ÄÇ</li>
            <li>ÊàëÂÄëÁÑ°Ê≥ïÁç≤Âèñ‰Ω†ÁöÑÊö±Á®±„ÄÅÈ†≠ÂÉè„ÄÅÁîöËá≥Â•ΩÂèãË≥áË®ä„ÄÇ</li>
            <li>Ê•≠ÁïåÈ¶ñÂâµÊèê‰æõÂÖàÈÄ≤Âä†ÂØÜÊäÄË°ìÈõ≤Á´ØÁ©∫ÈñìÔºå‰∏çÂè™‰øùË≠∑Â∞çË©±ÔºåË≥áÊñô‰πü‰∏Ä‰Ωµ‰øùÈöú„ÄÇ</li>
            <li>ÂºïÂÖ•Êô∂ÁâáÂç≥Ë∫´ÂàÜÊ¶ÇÂøµÔºå‰ªª‰Ωï‰∫∫ÁÑ°Ê≥ïÈÄèÈÅéÊâãÊ©üËôüÁ¢ºÊàñ E-mail ËøΩËπ§‰Ω†ÁöÑË∫´ÂàÜ„ÄÇ</li>
          </ul>
        </div>
        <div class="welcome-actions">
          <button type="button" id="welcomeNext">ÈñãÂßãË®≠ÂÆöÂØÜÁ¢º</button>
        </div>
      </div>
    </div>
  </main>

    <div id="loginLoading" class="loading-backdrop hidden" role="presentation">
      <div class="loading-card" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div id="loginLoadingText" class="loading-text">ÁôªÂÖ•‰∏≠ÔºåË´ãÁ®çÂÄô‚Ä¶</div>
      </div>
    </div>

    <section class="dev-hidden">
      <button id="btnHealth" type="button" aria-hidden="true"></button>
      <button id="btnClear" type="button" aria-hidden="true"></button>
      <pre id="out" aria-hidden="true"></pre>
      <button id="btnDevClearLocal" type="button" aria-hidden="true"></button>
    </section>

    <script>
      window.API_ORIGIN = 'https://api.message.sentry.red';
      (function(){
        const overlay = document.getElementById('orientationOverlay');
        const docEl = document.documentElement;
        const mq = window.matchMedia('(orientation: portrait)');
        const isMobileLike = () => {
          const touch = navigator.maxTouchPoints || navigator.msMaxTouchPoints || 0;
          const shortEdge = Math.min(window.innerWidth, window.innerHeight);
          const ua = navigator.userAgent || '';
          const looksMobileUA = /iPhone|iPad|Android|Mobile/i.test(ua);
          return shortEdge <= 1024 && (touch > 0 || looksMobileUA);
        };
        function update(){
          if (!isMobileLike()) {
            docEl.classList.remove('orientation-block');
            if (overlay) overlay.setAttribute('aria-hidden','true');
            return;
          }
          const portrait = mq.matches || window.innerHeight >= window.innerWidth;
          if (portrait) {
            docEl.classList.remove('orientation-block');
            if (overlay) overlay.setAttribute('aria-hidden','true');
          } else {
            docEl.classList.add('orientation-block');
            if (overlay) overlay.setAttribute('aria-hidden','false');
          }
        }
        if (mq.addEventListener) mq.addEventListener('change', update); else mq.addListener(update);
        window.addEventListener('orientationchange', update);
        window.addEventListener('resize', update);
        update();
        if (screen.orientation && screen.orientation.lock && isMobileLike()) {
          screen.orientation.lock('portrait').catch(() => {});
        }
      })();
    </script>
    <script type="module" src="/app/ui/login-ui.js"></script>
  </body>
</html>
